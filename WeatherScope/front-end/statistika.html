<!doctype html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Статистика | WeatherScope</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
    <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3 fs-6 text-white" href="index.html">WeatherScope</a>
    <div class="navbar-nav flex-row ms-auto">
      <a class="nav-link px-3 text-white" href="settings.html">Settings</a>
      <a class="nav-link px-3 text-white" href="login.html">Sign in</a>
      <a class="nav-link px-3 text-white" href="register.html">Register</a>
    </div>
  </header>

  <div class="container-fluid">
    <div class="row">
      <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
        <div class="position-sticky">
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="index.html">
                <i class="bi bi-cloud-sun me-2"></i>
                Головна
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="favourite_cities.html">
                <i class="bi bi-geo-alt me-2"></i>
                Улюблені міста
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="statistika.html">
                <i class="bi bi-bar-chart me-2"></i>
                Статистика
              </a>
            </li>
          </ul>

          <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted text-uppercase">
            <span>Налаштування</span>
            <a class="link-secondary" href="#">
              <i class="bi bi-gear"></i>
            </a>
          </h6>
          <ul class="nav flex-column mb-2">
            <li class="nav-item">
              <a class="nav-link" href="settings.html">
                <i class="bi bi-sliders me-2"></i>
                Settings
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="login.html">
                <i class="bi bi-box-arrow-right me-2"></i>
                Sign out
              </a>
            </li>
          </ul>
        </div>
      </nav>

      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
        <div class="row mt-5">
          <div class="col-12 text-center">
            <h1 class="fw-bold">Історія погоди за 7 днів</h1>
            <p class="text-secondary">Перегляд статистики погоди за останній тиждень</p>
          </div>
        </div>

        <div class="row justify-content-center mt-4">
          <div class="col-md-6">
            <form id="forecast-form">
              <div class="input-group">
                <input type="text" id="city-input" class="form-control" placeholder="Введіть місто" required>
                <button class="btn btn-primary" type="submit">Показати</button>
              </div>
            </form>
          </div>
        </div>

        <div id="forecast-container" class="row justify-content-center mt-4"></div>
      </main>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.getElementById("forecast-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const city = document.getElementById("city-input").value.trim();
      if (!city) return;

      const container = document.getElementById("forecast-container");
      container.innerHTML = '<p class="text-center">Завантаження...</p>';

      try {
        const res = await fetch(`http://127.0.0.1:8000/api/v1/weather-history/?city=${city}&units=metric`);
        const data = await res.json();

        container.innerHTML = "";

        if (!data.history || data.history.length === 0) {
          container.innerHTML = `<p class='text-danger text-center'>Не вдалося отримати історію погоди</p>`;
          return;
        }

        data.history.forEach(day => {
          const card = document.createElement("div");
          card.className = "col-md-3 m-2";
          card.innerHTML = `
            <div class="card text-center shadow-sm">
              <div class="card-body">
                <h5>${day.date}</h5>
                <img src="https://openweathermap.org/img/wn/${day.icon || '01d'}@2x.png" alt="${day.desc || 'Погода'}">
                <p class="fs-5 fw-bold">${Math.round(day.temp * 10) / 10}°C</p>
                <p class="text-capitalize">${day.desc || 'Немає опису'}</p>
                <div class="mt-2 small text-muted">
                  <div>Мін: ${Math.round(day.temp_min * 10) / 10}°C / Макс: ${Math.round(day.temp_max * 10) / 10}°C</div>
                  <div>Вологість: ${day.humidity}%</div>
                </div>
              </div>
            </div>
          `;
          container.appendChild(card);
        });
      } catch (error) {
        container.innerHTML = `<p class='text-danger text-center'>Помилка завантаження даних: ${error.message}</p>`;
      }
    });
  </script>
</body>
</html>